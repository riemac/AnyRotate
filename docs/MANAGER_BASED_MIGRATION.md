# LeapHandè¿ç»­æ—‹è½¬ä»»åŠ¡ - ManagerBasedRLEnvæ¶æ„è¿ç§»å®Œæˆ

## ğŸ‰ è¿ç§»æˆåŠŸï¼

æˆ‘ä»¬å·²ç»æˆåŠŸå°†LeapHandè¿ç»­æ—‹è½¬ä»»åŠ¡ä»DirectRLEnvæ¶æ„è¿ç§»åˆ°ManagerBasedRLEnvæ¶æ„ï¼Œå¹¶ä¸”å®Œå…¨æ”¯æŒå¤šç§å¼ºåŒ–å­¦ä¹ åº“ï¼ŒåŒ…æ‹¬æ‚¨åå¥½çš„**rl_games**åº“ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
source/leaphand/leaphand/tasks/manager_based/leaphand/
â”œâ”€â”€ __init__.py                           # ç¯å¢ƒæ³¨å†Œ
â”œâ”€â”€ leaphand_continuous_rot_env_cfg.py    # ç¯å¢ƒé…ç½®
â”œâ”€â”€ agents/                               # æ™ºèƒ½ä½“é…ç½®
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ rl_games_ppo_cfg.yaml            # rl_gamesé…ç½® â­
â”‚   â””â”€â”€ rsl_rl_ppo_cfg.py                # RSL-RLé…ç½®
â””â”€â”€ mdp/                                  # MDPå‡½æ•°æ¨¡å—
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ observations.py                   # è§‚æµ‹å‡½æ•°
    â”œâ”€â”€ rewards.py                        # å¥–åŠ±å‡½æ•°
    â”œâ”€â”€ terminations.py                   # ç»ˆæ­¢æ¡ä»¶
    â””â”€â”€ events.py                         # äº‹ä»¶å‡½æ•°
```

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

### âœ… å®Œæ•´çš„ManagerBasedRLEnvæ¶æ„
- **Action Manager**: 16ç»´æ‰‹éƒ¨å…³èŠ‚ä½ç½®æ§åˆ¶
- **Observation Manager**: éå¯¹ç§°Actor-Criticè§‚æµ‹
  - Policyè§‚æµ‹: 63ç»´ (æ‰‹éƒ¨çŠ¶æ€ + æŒ‡å°–ä½ç½® + åŠ¨ä½œå†å² + æ—‹è½¬è½´)
  - Criticè§‚æµ‹: 92ç»´ (Policyè§‚æµ‹ + ç‰©ä½“çŠ¶æ€ç­‰ç‰¹æƒä¿¡æ¯)
- **Reward Manager**: è¿ç»­æ—‹è½¬å¥–åŠ±æœºåˆ¶
  - æ—‹è½¬é€Ÿåº¦å¥–åŠ± (æƒé‡: 15.0)
  - æŠ“å–å¥–åŠ± (æƒé‡: 8.0)
  - ç¨³å®šæ€§å¥–åŠ± (æƒé‡: 3.0)
  - åŠ¨ä½œå¹³æ»‘æƒ©ç½š (æƒé‡: -0.0005)
- **Termination Manager**: ç‰©ä½“æ‰è½æ£€æµ‹ + è¶…æ—¶ç»ˆæ­¢
- **Event Manager**: å®Œæ•´çš„åŸŸéšæœºåŒ–æ”¯æŒ

### âœ… å¤šå¼ºåŒ–å­¦ä¹ åº“æ”¯æŒ
- **rl_games** â­ (æ‚¨çš„é¦–é€‰)
- **RSL-RL** (å®˜æ–¹æ¨è)
- **skrl** (æ¨¡å—åŒ–è®¾è®¡)

### âœ… é«˜çº§RLæŠ€å·§é›†æˆ
- åŸŸéšæœºåŒ– (ç‰©ç†å‚æ•°ã€è´¨é‡ã€æ‘©æ“¦ç­‰)
- è§‚æµ‹å™ªéŸ³å’Œå»¶æ—¶
- åŠ¨ä½œå»¶æ—¶å’Œå¹³æ»‘
- è¯¾ç¨‹å­¦ä¹ æ¡†æ¶
- éå¯¹ç§°Actor-Criticæ¶æ„

## ğŸ® ä½¿ç”¨æ–¹æ³•

### 1. æµ‹è¯•ç¯å¢ƒ
```bash
cd /home/hac/isaac/leaphand
python scripts/test_manager_based_continuous_rot.py --num_envs 4 --headless
```

### 2. ä½¿ç”¨rl_gamesè®­ç»ƒ â­
```bash
# åŸºç¡€è®­ç»ƒ
python scripts/train_rl_games.py --num_envs 4096 --headless

# æŒ‡å®šå‚æ•°è®­ç»ƒ
python scripts/train_rl_games.py \
    --num_envs 4096 \
    --max_iterations 2000 \
    --seed 42 \
    --headless

# ä»æ£€æŸ¥ç‚¹ç»§ç»­è®­ç»ƒ
python scripts/train_rl_games.py \
    --checkpoint /path/to/checkpoint.pth \
    --num_envs 4096 \
    --headless
```

### 3. ä½¿ç”¨RSL-RLè®­ç»ƒ
```bash
python -m isaaclab_tasks.train \
    --task Isaac-Leaphand-ContinuousRot-Manager-v0 \
    --num_envs 4096 \
    --headless
```

## ğŸ”§ rl_gamesé…ç½®è¯¦è§£

æˆ‘ä»¬çš„rl_gamesé…ç½® (`agents/rl_games_ppo_cfg.yaml`) é’ˆå¯¹è¿ç»­æ—‹è½¬ä»»åŠ¡è¿›è¡Œäº†ä¼˜åŒ–ï¼š

```yaml
params:
  algo:
    name: a2c_continuous
  
  model:
    name: continuous_a2c_logstd
  
  network:
    separate: True  # æ”¯æŒéå¯¹ç§°Actor-Critic
    mlp:
      units: [512, 512, 256]
      activation: elu
  
  config:
    normalize_input: True
    normalize_value: True
    gamma: 0.99
    tau: 0.95
    learning_rate: 1e-4
    entropy_coef: 0.005  # é¼“åŠ±æ¢ç´¢
    horizon_length: 24
    mini_epochs: 8
```

## ğŸ¯ è¿ç»­æ—‹è½¬ä»»åŠ¡ç‰¹æ€§

### æ ¸å¿ƒæœºåˆ¶
- **æ—‹è½¬è½´é…ç½®**: æ”¯æŒZè½´ã€Xè½´ã€Yè½´ã€éšæœºè½´ã€æ··åˆè½´æ¨¡å¼
- **è¿ç»­æ—‹è½¬å¥–åŠ±**: åŸºäºè§’é€Ÿåº¦è€Œéç›®æ ‡è§’åº¦
- **è¯¾ç¨‹å­¦ä¹ **: ä»ç®€å•è½´åˆ°å¤æ‚æ··åˆè½´çš„æ¸è¿›è®­ç»ƒ

### è§‚æµ‹ç©ºé—´
- **æ‰‹éƒ¨çŠ¶æ€**: å…³èŠ‚ä½ç½®ã€é€Ÿåº¦ã€æŒ‡å°–ä½ç½®
- **ä»»åŠ¡ä¿¡æ¯**: ç›®æ ‡æ—‹è½¬è½´ã€åŠ¨ä½œå†å²
- **ç‰¹æƒä¿¡æ¯** (ä»…Critic): ç‰©ä½“å®Œæ•´çŠ¶æ€ã€å…³èŠ‚åŠ›çŸ©

### å¥–åŠ±è®¾è®¡
- **ä¸»å¥–åŠ±**: æ²¿ç›®æ ‡è½´çš„æ—‹è½¬é€Ÿåº¦
- **è¾…åŠ©å¥–åŠ±**: æŠ“å–ç¨³å®šæ€§ã€åŠ¨ä½œå¹³æ»‘æ€§
- **ç»ˆæ­¢æ¡ä»¶**: ç‰©ä½“æ‰è½æ£€æµ‹

## ğŸ”„ ä¸DirectRLEnvçš„å¯¹æ¯”

| ç‰¹æ€§ | DirectRLEnv | ManagerBasedRLEnv |
|------|-------------|-------------------|
| æ¶æ„ | å•ä½“ç±»å®ç° | æ¨¡å—åŒ–Managerç³»ç»Ÿ |
| å¯æ‰©å±•æ€§ | ä½ | é«˜ |
| ä»£ç å¤ç”¨ | ä½ | é«˜ |
| é…ç½®çµæ´»æ€§ | ä½ | é«˜ |
| å®˜æ–¹æ”¯æŒ | æœ‰é™ | å®Œæ•´ |
| RLåº“æ”¯æŒ | RSL-RL | RSL-RL + rl_games + skrl |

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

1. **å¼€å§‹è®­ç»ƒ**: ä½¿ç”¨rl_gamesè¿›è¡Œåˆæ­¥è®­ç»ƒæµ‹è¯•
2. **å‚æ•°è°ƒä¼˜**: æ ¹æ®è®­ç»ƒç»“æœè°ƒæ•´å¥–åŠ±æƒé‡å’Œç½‘ç»œç»“æ„
3. **è¯¾ç¨‹å­¦ä¹ **: å®ç°ä»ç®€å•åˆ°å¤æ‚çš„æ—‹è½¬è½´è®­ç»ƒç­–ç•¥
4. **æ€§èƒ½ä¼˜åŒ–**: æ ¹æ®éœ€è¦è°ƒæ•´ç¯å¢ƒæ•°é‡å’Œè®­ç»ƒå‚æ•°

## ğŸŠ æ€»ç»“

âœ… **è¿ç§»å®Œæˆ**: DirectRLEnv â†’ ManagerBasedRLEnv  
âœ… **rl_gamesæ”¯æŒ**: å®Œæ•´é…ç½®å’Œè®­ç»ƒè„šæœ¬  
âœ… **æ¨¡å—åŒ–è®¾è®¡**: æ˜“äºæ‰©å±•å’Œç»´æŠ¤  
âœ… **é«˜çº§RLæŠ€å·§**: åŸŸéšæœºåŒ–ã€éå¯¹ç§°è§‚æµ‹ç­‰  
âœ… **å³ç”¨æ€§**: å¯ç›´æ¥å¼€å§‹è®­ç»ƒ  

æ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨åå¥½çš„rl_gamesåº“æ¥è®­ç»ƒLeapHandè¿ç»­æ—‹è½¬ä»»åŠ¡äº†ï¼ğŸ‰
